<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title id="title"></title>
</head>
<body>
<a href="/">Home</a>
<a id="leaderboardLink">Leaderboard</a>
<a href="/logout">Logout</a>
<br/>
<h2>Description</h2>
<p id="desc" style="white-space: pre-wrap"></p>
<form name="submission" enctype="multipart/form-data">
	<label for="lang">Language</label>
	<select name="lang" id="lang">
	</select>
	<label for="file">File:</label>
	<input type="file" name="file" id="file"/>
	<br/>
	<input id="submitButton" type="submit"/>
</form>
<script>
    window.addEventListener('load', () => {
        fetch(document.location.href+'/data').then(async (resp) => {
            const res = await resp.json();
            document.getElementById('title').innerText = `Level ${res.level}`;

            const leaderboardLink = document.getElementById('leaderboardLink');
            leaderboardLink.href = `/leaderboards/${res.level}`;

            const desc = document.getElementById('desc');
            desc.innerText = res.desc;

            const langSelect = document.getElementById('lang');
            for (const [key, value] of Object.entries(res.langs)) {
                const option = document.createElement('option');
                option.text = key;
                option.value = value;
                langSelect.add(option);
            }
            const form = document.submission;
            form.addEventListener('submit', (event) => {
                event.preventDefault();
                const submitButton = document.getElementById('submitButton');
				submitButton.disabled = true;
                const data = new FormData(form);
                fetch(`/test/${res.level}`, {method: 'POST', body: data}).then(async (resp) => {
                    const res = await resp.json();
                    if (res.success) {
                        alert('success');
                    } else {
                        alert(res.error);
                    }
                    document.getElementById('file').value = null;
					submitButton.disabled = false;
                });
            });
        });
    });
</script>
</body>
</html>